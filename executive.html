<!DOCTYPE html>
<html>
<body>

<h1>Executive Dashboard</h1>
<button onclick="logoutUser()">Logout</button>

<script type="module">
import { protectPage } from "./js/guards.js";
protectPage("executive");
</script>
  <h2>Loan Applications</h2>
<ul id="loanList"></ul>

<script type="module">
import { db } from "./js/firebase.js";
import {
  collection,
  getDocs,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const list = document.getElementById("loanList");
const snap = await getDocs(collection(db, "loans"));

snap.forEach(d => {
  const l = d.data();
  const li = document.createElement("li");
  li.innerHTML = `
    ${l.memberName} - KSH ${l.amount} - ${l.status}
    <button onclick="approve('${d.id}')">Approve</button>
  `;
  list.appendChild(li);
});

window.approve = async (id) => {
  await updateDoc(doc(db, "loans", id), { status: "approved" });
  location.reload();
};
</script>

<script type="module" src="./js/app.js"></script>
</body>
</html>
